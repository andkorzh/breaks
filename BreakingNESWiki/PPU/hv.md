# H/V Счётчики

H/V-счетчики считают количество пикселей в строке и количество строк, соответственно. H тикает от 0 до 340 (включая), V тикает от 0 до 261 (включая). Итого видимая часть экрана представляет собой 262 строки по 341 пикселя каждая.

## Устройство H/V счетчиков

Вот, один "шаг" H/V счетчика:

![HV_stage](/BreakingNESWiki/imgstore/HV_stage.jpg)

- inc: если на входе 1, то счетчик делает инкремент, иначе на выходе (out) текущее значение.
- carry: перенос на следующий шаг
- RES: сигнал общего сброса
- HC (или VC у V-counter): сигнал очистки всего счетчика, H-counter сбрасывается когда декодер обнаруживает там значение H=340, V-counter сбрасывается при V=261.

Так как H-counter считает все время, то вход самого первого каскада заведен на Vcc.
Вход V-counterа регулируется H-декодером. когда H=340, то вход V устанавливается в 1, что дает возможность увеличить его значение на 1.
carry каждого предыдущего бита заведен на inc следующего, получается carry-chain.

Весь H-counter. Слева транзисторная схема, справа - логическая.

<img src="/BreakingNESWiki/imgstore/H_trans.jpg" width="600px"> <img src="/BreakingNESWiki/imgstore/H.jpg" width="600px">

- Переносы с 0 по 4 суммируются через NOR и подаются на вход 5.
- Вход 0 заведен на Vcc (счетчик всегда считает)

## Зачем нужна логика переноса

Счетчики включают в свой состав такой небольшой кусочек:

![CARRYH](/BreakingNESWiki/imgstore/CARRYH.jpg)

Зачем он нужен? Скорее всего, чтобы уменьшить propagation delay цепочки переносов.
