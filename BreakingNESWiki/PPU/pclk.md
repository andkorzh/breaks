# Pixel Clock (PCLK)

Pixel clock (сокращенно PCLK) используется всеми узлами PPU (кроме генератора фаз видеосигнала).

Причем симметрично используются как низкий уровень (`/PCLK`), так и высокий (`PCLK`). Такой подоход внутренней реализации циклов был широко распространен в эру микросхем NMOS. Поэтому при анализе схем PPU следует думать не о PCLK как тактовом сигнале, а о двух "состояниях" (стейтах) - PCLK=0 и PCLK=1.

Условно `/PCLK` можно назвать "подготовка", а `PCLK` - "вывод пикселя".

`PCLK` получается путем замедления входного тактового сигнала `CLK` (21.48 MHz) в 4 раза.

Для этого используется делитель на статических защелках:

<img src="/BreakingNESWiki/imgstore/pclk.jpg" width="400px">

На выходе делителя находится много push/pull усилительных каскадов, поскольку сигнал `PCLK` должен быть достаточно мощным, т.к. разводится практически по всей микросхеме. Для этого (чуть правее на кристалле) находится гребенка ещё более мощных push/pull инверторов:

![pclk_amp](/BreakingNESWiki/imgstore/pclk_amp.jpg)

Входной тактовый сигнал `CLK` используется исключительно в [фазогенераторе видеотракта](video_out.md) PPU.

## Состояние при включении питания

Сложно сказать какие значения находятся на защелках (затворах). Если полагать, что после включения питания `CLK` равен 0, а `z` (терминами HDL означает "отсоединено") на затворе это то же самое, что 0 (затвор закрыт), то значения защелок примут следующие значения: [ 0, 1, 0, 1 ]

(Первая защелка находится рядом с сигналом `RES`)

Но вообще правильнее считать, что значение защелок не определено (`x`)

## Псевдокод логики PCLK

```c
if ( CLK == 1 )
{
    PCLK_Latch[0] = PCLK_Latch[3] & ~RES;
    PCLK_Latch[2] = ~PCLK_Latch[1];
}
else
{
    PCLK_Latch[1] = ~PCLK_Latch[0];
    PCLK_Latch[3] = ~PCLK_Latch[2];
}

PCLK = ~PCLK_Latch[3];
nPCLK = ~PCLK;
```
