# Обзор PPU

PPU (Picture Processing Unit) - специализированная микросхема для генерации видеосигнала.

Примерная картинка, которую может выдать PPU:

<img src="/BreakingNESWiki/imgstore/ppu/battletoads.jpg" width="400px">

Ревизии микросхем PPU:

|Ревизия|Описание|
|---|---|
|2C02G|Применялась в Famicom и американской версии NES. Генерирует NTSC сигнал.|
|2C02H| |
|2C03|RGB-версии для аркадных автоматов на базе NES (PlayChoice-10, Vs. System)|
|2C03B| |
|2C04-0001| |
|2C04-0002| |
|2C04-0003| |
|2C04-0004| |
|2C05| |
|2C07-0|PAL-версия PPU для европейских NES|

Возможно существуют (но их никто не видел):
- 2C01: Отладочная версия NTSC PPU (?)
- 2C06: Отладочная версия PAL PPU (?)

## Архитектура

Основные компоненты PPU:

![PPU_preview](/BreakingNESWiki/imgstore/PPU_preview.jpg)

- VIDEO OUT: содержит схему формирования NTSC-сигнала и ЦАП, для преобразования его в аналоговую форму. То есть по сути PPU является полу-аналоговой микросхемой, так как с контакта VOUT выходит уже готовый к употреблению аналоговый сигнал (композитное видео).
- Рядом со схемой VOUT находится блок управления, который на базе двух счетчиков H и V формирует пачку управляющих сигналов, для остальных компонентов.
- Палитра. Содержит 16 цветов бэкграунда и 16 цветов спрайтов. По индексу в палитре в COLOR BUFFER загружается цвет пикселя, который будет выведен на экран.
- Мультиплексор (MUX). Выбирает что будет выводиться на экран: точка бэкграунда или точка спрайта, на основе их приоритетов. Также есть возможность подмешать цвет с внешних контактов EXT.
- Регистры. Всего адресное пространство PPU позволяет адресовать 8 внутренних регистров. Разработчики очень хитро подошли к вопросу организации регистров и запись по одному адресу может делать 2 разных действия.
- Спрайтовая память (OAM). Содержит данные 64 спрайтов, а также дополнительное место для хранения выбранных 8 текущих спрайтов.
- Спрайтовая логика. На базе H-счетчика выбирает 8 текущих спрайтов, которые в процессе сравнения помещаются в дополнительную память OAM.
- Спрайтовая FIFO (OAM FIFO). Содержит схему, которая активирует вывод 8 выбранных спрайтов в нужный момент, а также схему контроля их приоритета.
- Схема управления адресной шиной. Управляет адресацией VRAM.
- Схемы выборки данных (DATA READER). Схема для выборки исходных данных из VRAM: тайлов и атрибутов. Включает в себя генератор адреса PAR и схему получения цвета бэкграунда.
