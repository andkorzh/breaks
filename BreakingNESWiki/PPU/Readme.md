# Обзор PPU

PPU (Picture Processing Unit) - специализированная микросхема для генерации видеосигнала.

Примерная картинка, которую может выдать PPU:

<img src="/BreakingNESWiki/imgstore/battletoads.png" width="400px">

Существует следующие версии микросхем PPU:
- 2C02: применялась в Famicom и американской версии NES. Генерирует NTSC сигнал.
- 2C07: PAL-версия PPU для европейских NES
- 2C03, 2C04, 2C05: RGB-версии для аркадных автоматов на базе NES (PlayChoise-10, Vs. System)

Возможно существуют (но их никто не видел):
- 2C01: Отладочная версия NTSC PPU (?)
- 2C06: Отладочная версия PAL PPU (?)

## Архитектура

Основные компоненты PPU:

![PPU_preview](/BreakingNESWiki/imgstore/PPU_preview.jpg)

- VIDEO OUT: содержит схему формирования NTSC-сигнала и ЦАП, для преобразования его в аналоговую форму. То есть по сути PPU является полу-аналоговой микросхемой, так как с контакта VOUT выходит уже готовый к употреблению аналоговый сигнал (композитное видео).
- Рядом со схемой VOUT находится блок управления, который на базе двух счетчиков H и V формирует пачку управляющих сигналов, для остальных компонентов.
- Палитра. Содержит 16 цветов бекграунда и 16 цветов спрайтов. По индексу в палитре в COLOR BUFFER загружается цвет пикселя, который будет выведен на экран.
- Мультиплексор (MUX). Выбирает что будет выводиться на экран: точка бекграунда или точка спрайта, на основе их приоритетов. Также есть возможность подмешать цвет с внешних контактов EXT.
- Регистры. Всего адресное пространство PPU позволяет адресовать 8 внутренних регистров. Разработчики очень хитро подошли к вопросу организации регистров и запись по одному адресу может делать 2 разных действия.
- Спрайтовая память (OAM). Содержит данные 64 спрайтов, а также дополнительное место для хранения выбранных 8 текущих спрайтов.
- Спрайтовая логика. На базе H-счетчика выбирает 8 текущих спрайтов, которые в процессе сравнения помещаются в дополнительную память OAM.
- Спрайтовая FIFO (OAM FIFO). Содержит схему, которая активирует вывод 8 выбранных спрайтов в нужный момент, а также схему контроля их приоритета.
- Схема управления адресной шиной. Управляет адресацией VRAM.
- Схемы выборки данных (data reader). Схема для выборки исходных данных из VRAM: тайлов и атрибутов.
