# Сравнение спрайтов

Схема сравнения спрайтов занимается сравнением всех 64 спрайтов и выборкой первых 8 спрайтов, которые встречаются раньше всех на текущей строке (H). То что PPU умеет рисовать только первые 8 спрайтов строки - широко известный факт, который приходится учитывать при программировании NES. Обычно программисты применяют перемешивание спрайтов, но даже при этом возникает эффект "мерцания" спрайтов.

Выбранные спрайты помещаются в дополнительную память OAM2, откуда потом попадают для дальнейшей обработки в [OAM FIFO](fifo.md).

Схема включает в себя:
- Счетчик индекса OAM, для выборки следующего спрайта для сравнения
- Счетчик индекса OAM2, для сохранения результатов сравнения
- Схемы контроля счетчиками
- Компаратор, который по сути является маленьким АЛУ и выполняет операцию знакового вычитания (A - B)
- Схему управления сравнением, которая и реализует всю логику работы сравнения спрайтов

Схемы для управления счетчиками разделены предварительно, возможно есть смысл их объединить в одну схему.

Также схемы содержат большое количество пока непонятных сигналов (напр. `LOL`, `MILF`, `OMFG` и др.) 

## Счетчик индекса OAM

![oam_index_counter](/BreakingNESWiki/imgstore/oam_index_counter.jpg)

## Управление счетчиком индекса OAM

![oam_index_counter_control](/BreakingNESWiki/imgstore/oam_index_counter_control.jpg)

## Счетчик индекса Temp OAM (OAM2)

![oam2_index_counter](/BreakingNESWiki/imgstore/oam2_index_counter.jpg)

## Общее управление счетчиками

![oam_counters_control](/BreakingNESWiki/imgstore/oam_counters_control.jpg)

## Компаратор

![oam_cmpr](/BreakingNESWiki/imgstore/oam_cmpr.jpg)

## Схема управления сравнением

![oam_eval_control](/BreakingNESWiki/imgstore/oam_eval_control.jpg)
