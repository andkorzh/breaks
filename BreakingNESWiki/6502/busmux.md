# Шинный мультиплексор

Все разрозненные куски схем нижней части, где внутренние шины соединяются друг с другом или шины соединяются с константами было решено выделить в отдельный раздел.

Причина этого в том, что работа с шинами это "любимый топик" при проектировании схем и лучше чтобы все места где происходится работа с шинами были в одном месте.

## Precharge

Все шины подзаряжаются во время PHI2. Сделано это для формирования констант: из значения 0xff, которое получилось во время подзарядки получаются другие значения путём соединения нужных разрядов с 0.
Учитывайте, что подзаряженное значение шины сохраняется на следующий полуцикл (PHI1), где и происходит формирование нужных констант.

Шина SB подзаряжается в регистре S:

![busmpx1](/BreakingNESWiki/imgstore/6502/busmpx1.jpg)

Шина DB подзаряжается в DataLatch:

![busmpx2](/BreakingNESWiki/imgstore/6502/busmpx2.jpg)

Шина ADL подзаряжается в районе регистра PC (биты 0-3), остальные FET разбросаны между PC и DL:

![busmpx3](/BreakingNESWiki/imgstore/6502/busmpx3.jpg)
![busmpx5](/BreakingNESWiki/imgstore/6502/busmpx5.jpg)

Шина ADH подзаряжается в регистре AC (биты 0-2), остальные FET разбросаны между PC и DL:

![busmpx4](/BreakingNESWiki/imgstore/6502/busmpx4.jpg)
![busmpx5](/BreakingNESWiki/imgstore/6502/busmpx5.jpg)

## 0/ADL

Команды 0/ADL0, 0/ADL1, 0/ADL2 используются для формирования адреса прерывания. FET находятся рядом с терминалами A0-A2.

![busmpx6](/BreakingNESWiki/imgstore/6502/busmpx6.jpg)

## 0/ADH

Команды 0/ADH0 и 0/ADH17 применяются рядом с регистром AC. Команда 0/ADH0 применяется для разряда 0. Команда 0/ADH17 применяется для разрядов 1-7.

![busmpx7](/BreakingNESWiki/imgstore/6502/busmpx7.jpg)

## Соединение шин с шинами

Команды SB/DB и SB/ADH используются для соединения шин друг с другом. FET для применения этих команд находятся рядом с регистром AC.

![busmpx8](/BreakingNESWiki/imgstore/6502/busmpx8.jpg)

Данные команды доставляют больше всего неудобств при перекладывании схем 6502 на Verilog или симуляции, т.к. соединение шин реализовано двунаправленным FET.
