# Синхронный анализ

Данный раздел содержит краткое описание что происходит с теми или иными модулями микросхемы, при изменении фазы тактовых сигналов.

Комбинационые схемы виртуально работают "мгновенно" и их анализ особого интереса не представляет. Но такие модули всё равно указаны в таблице.

Памятка:
- PHI0 основной тактовый сигнал (сейчас более распространено обозначение `CLK`)
- PHI1 верхний уровень, когда PHI0 нижний
- PHI2 совпадает по уровню с PHI0
- Между PHI1 и PHI2 есть небольшой dead time

Таким образом в 6502 используется подход, называемый "dual rails".

## Верхняя часть

|Модуль|PHI1|PHI2|
|---|---|---|
|Clkgen|Схема формирует парные сигналы PHI1/PHI2|Не содержит каких-то защёлок или циклов.|
|#NMI Pad|Нет особенностей. Значение nmip_ff не запоминается на дополнительной защёлке, т.к. для сигнала #NMI далее находится схема edge-detect|Входной FF nmip_ff запоминает значение сигнала #NMI|
|#IRQ Pad|Выходная защёлка irqp_latch запоминает состояние входного irqp_ff|Входной FF irqp_ff запоминает значение сигнала #IRQ|
|#RES Pad|Выходная защёлка resp_latch запоминает состояние входного resp_ff (инверсное значение с выхода #q)|Входной FF resp_ff запоминает значение сигнала #RES|
|RDY Pad|Защёлка prdy_latch2 запоминает инверсное значение защёлки prdy_latch1|Защёлка prdy_latch1 запоминает инверсное значение входного сигнала RDY. Вместе защёлки prdy_latch1/2 используются для формирование сигнала `/PRDY`|
|SO Pad|so_latch1, so_latch3|so_latch2. Защёлки so_latch1/2/3 используются для детектирования фронта (negedge) входного сигнала `SO`|
|R/W Pad|Защёлка rw_latch запоминает значение сигнала WR| |
|SYNC Pad|не содержит последовательностных элементов|Сигнал T1 просто выводится наружу через буфер|
|Decoder|не содержит последовательностных элементов|Входы IR/Tx формируют выходы декодера комбинацинным образом|
|IR| | |
|Extra Counter (T2-T5)| | |
|Predecode| | |
|Branch Logic| | |
|BRK Processing| | |
|Interrupt vector| | |
|Regs Control| | |
|Flags Control| | |
|Flags| | |
|ALU Control| | |
|Bus Control| | |
|PC Control| | |
|Dispatch Unit| | |

## Нижняя часть

|Модуль|PHI1|PHI2|
|---|---|---|
|Address Bus| | |
|Data Bus| | |
|Regs| | |
|ALU| | |
|PC| | |
|Internal buses|На начало полутакта все внутренние шины (SB, DB, ADL, ADH) имеют значение 0xFF (данное значение хранится за счёт ёмкости шин). Затем различными командами они модифицируются: либо обновляются новыми значениями из регистров, либо соединяются друг с другом (SB<->DB, SB<->ADH), либо формируются константные значения, путём "разрядки" части битов в 0. :warning: При выполнении непредусмотренных инструкций на внутренних шинах могут возникнуть конфликты (например если сразу 2 регистра выдаются на одну и ту же шину); все такие конфликты разрешаются по правилу "Побеждает земля".|Все внутренние шины (SB, DB, ADL, ADH) "подзаряжаются" и имеют значение 0xFF|
