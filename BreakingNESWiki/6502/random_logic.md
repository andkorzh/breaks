# Рандомная логика

![6502_locator_random](/BreakingNESWiki/imgstore/6502_locator_random.jpg)

"Рандомная логика" - это попытка перевести англ. название "random logic". Название не имеет ничего общего со случайными числами, оно просто отражает сущность произвольным образом разбросанных там и сям схем.

Эта логика является мыслительным органом процессора и полностью определяет его поведение при обработке и выполнении инструкций.

С аппаратной точки зрения рандомная логика - это "хенд-мэйд" продукт инженеров [MOS](../MOS.md), представляющий собой месиво из транзисторов и проводов. Поэтому более правильным было бы вместо рандомной логики использовать название "хаотичная логика".

Полноразмерную транзисторную схему приводить тут нет необходимости, по причине того что проще будет осваивать её по составным частям.

Ниже вы можете ознакомиться со всеми функциональными блоками рандомной логики:
- [Управление регистрами](regs_control.md)
- [Управление АЛУ](alu_control.md)
- [Управление счетчиком инструкций (PC)](pc_control.md)
- [Управление шинами](bus_control.md)
- [Логика исполнения (dispatch)](dispatch.md)
- [Логика установки флагов](flags_control.md)
- [Флаги](flags.md)
- [Логика условных переходов](branch_logic.md)

## Принцип работы

В целом работа логики довольно комплексная (вы думали я опять скажу - простая? :smiley:):
- Логика исполнения (dispatch) дирижирует работой всего процессора. Она определяет когда нужно закончить выполнение инструкции, а также управляет инкрементом PC и счетчиком циклов. Дополнительно она включает в себя схему готовности процессора (RDY), которая управляется контактом RDY.
- После того, как логика исполнения начала выполнение следующей инструкции - код этой инструкции, а также текущий цикл подаются на декодер
- В зависимости от результатов декодирования схемы управления регистрами, АЛУ, PC и шинами выдают наружу в нижнюю часть специальные [управляющие команды](context_control.md)
- Дополнительно на поведение процессора влияют его флаги, а также логика обработки прерываний. А на флаги также влияют исполняемые инструкции.

Всё это в тесной упряжке управляет нижней частью процессора, где находится его контекст (регистры), АЛУ и связь с внешним миром посредством шин.

## Вспомогательные сигналы

Данный раздел содержит таблицу вспомогательных сигналов, которыми обмениваются все части рандомной логики (для справки):

|Название|Откуда|Куда|Описание|
|---|---|---|---|
|ACRL1|Dispatch|Dispatch|Один из выходов ACR Latch|
|ACRL2|Dispatch|Bus Control|Один из выходов ACR Latch|
|AND|ALU Control|Bus Control|Используется при формировании команды АЛУ `ANDS`|
|BR2|Decoder|PC Control, PC Increment|Branch T2|
|BR3|Decoder|PC Control, PC Increment|Branch T3|
|BRFW|Branch Logic, ALU Control|PC Control|Условный переход вперед|
|BRK5|Decoder|Interrupts, Regs Control|Используется для получения сигнала `STKOP`, а также уходит в схему [обработки прерываний](interrupts.md)|
|BRK6E|Interrupts|ALU Control, Bus Control|BRK6 (цикл 6 выполнения процедуры прерывания), во время полутакта PHI2|
|/BRTAKEN|Branch Logic|PC Control|Выполнить условный переход|
|C_OUT|Flags|ALU Control|Значение флага C|
|/C_OUT|Flags|ALU Control|Значение флага C (инвертированное)|
|DL/PCH|PC Control|Bus Control|Промежуточный сигнал|
|D_OUT|Flags|ALU Control|Значение флага D|
|JSR2|Decoder|Bus Control|Для получения сигнала `JSXY` и других схем управления шинами|
|/JSR2|Bus Control|Regs Control|Промежуточный сигнал, инверсия JSR2|
|IMPL|Decoder|ALU Control|Декодер X128. Дополнительно модифицирован сигналами Push/Pull (X129) и IR0.|
|INC_SB|ALU Control|Bus Control|Промежуточный сигнал ("Increment SB")|
|NOADL|Bus Control|ALU Control|Промежуточный сигнал ("No ADL")|
|PC/DB|PC Control|Dispatch|Выходной вспомогательный сигнал для схемы RW Control, которая входит в состав диспатчера|
|PGX|Bus Control|ALU Control|Промежуточный сигнал ("Page X")|
|/ready|Dispatch|All|Глобальный внутренний сигнал готовности процессора|
|RTI/5|Decoder|Regs Control, ALU Control|Используется для получения сигналов `STKOP` и `NOADL`|
|SBXY|Regs Control|Bus Control|Промежуточный сигнал ("SB Bus X,Y")|
|STK2|Decoder|Regs Control, ALU Control|Вспомогательный сигнал с декодера (X35)|
|STKOP|Regs Control|ALU Control|Промежуточный сигнал ("Stack Operation")|
|STOR|Dispatcher|Regs Control, ALU Control, RW Control|Промежуточный сигнал|
|STXY|Regs Control|Bus Control|Промежуточный сигнал ("Store X,Y")|
|T0|Short Cycle Counter|All|Процессор в цикле T0 выполнения инструкции|
|T1|PC Control|All|Процессор в цикле T1|
|T2|Decoder|All|Процессор в цикле T2|
|T5|Long Cycle Counter|All|Процессор в цикле T5|
|T6|Long Cycle Counter|All|Процессор в цикле T6|
|ZTST|Bus Control|Flags Control|Промежуточный сигнал ("Z Test")|

Во вспомогательных сигналах не стоить искать какой-то сакральный смысл - воcпринимайте их просто как промежуточные значения комбинаторной логики.
