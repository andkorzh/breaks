# Управление регистрами

![6502_locator_regs_control](/BreakingNESWiki/imgstore/6502/6502_locator_regs_control.jpg)

Скорее всего эту схему управления будут смотреть первой, поэтому напишу тут: будьте готовы увидеть в схемах управления большое количество промежуточных сигналов, которые могут приходить порой с совсем другой части рандомной логики. Сводная таблица всех промежуточных сигналов находится в главном разделе с обзором [рандомной логики](random_logic.md).

Схема управления регистрами отвечает за формирование [команд управления](context_control.md) обмена регистров с внутренними шинами.

![regs_control](/BreakingNESWiki/imgstore/6502/regs_control.jpg)

Входные сигналы:

|Сигнал|Описание|
|---|---|
|X0-X26|Выходы с декодера|
|/JSR2|Промежуточный сигнал со схемы [управления шинами](bus_control.md)|
|STK2|Просто вспомогательный сигнал с другой части декодера (X35)|
|STOR|Вспомогательный сигнал со схемы [диспатчера](dispatch.md)|
|/ready|Глобальный сигнал готовности процессора|

Выходные сигналы:

|Сигнал|Описание|
|---|---|
|SBXY|Промежуточный сигнал для схемы [управления шинами](bus_control.md). На самом деле этот сигнал в инверсной логике (`#SBXY`)|
|STXY|Промежуточный сигнал для схемы управления шинами|
|STKOP|Промежуточный сигнал ("Stack Operation") для схемы [управления АЛУ](alu_control.md)|
|#Y/SB|Промежуточный сигнал на защёлку, для получения команды Y/SB|
|#X/SB|Промежуточный сигнал на защёлку, для получения команды X/SB|
|#SB/X|Промежуточный сигнал на защёлку, для получения команды SB/X|
|#SB/Y|Промежуточный сигнал на защёлку, для получения команды SB/Y|
|#S/SB|Промежуточный сигнал на защёлку, для получения команды S/SB|
|#S/ADL|Промежуточный сигнал на защёлку, для получения команды S/ADL|
|#SB/S|Промежуточный сигнал на защёлку, для получения команды SB/S|
|BRK5|Выход с декодера X22. Используется для получения сигнала `STKOP`, а также уходит в схему [обработки прерываний](interrupts.md)|
|RTI/5|Выход с декодера X26. Используется для получения сигналов `STKOP` и `NOADL`|

Сигнал `TXS` (X13) используется в пределах этой схемы и наружу не выходит.

Промежуточные сигналы со схемы управления регистрами поступают на вход защелок команд управления:

![regs_control_commands_tran](/BreakingNESWiki/imgstore/6502/regs_control_commands_tran.jpg)

Команды управления регистрами:

|Команда|Описание|
|---|---|
|X/SB|Поместить значение регистра X на шину SB|
|Y/SB|Поместить значение регистра Y на шину SB|
|SB/X|Поместить значение шины SB на регистр X|
|SB/Y|Поместить значение шины SB на регистр Y|
|S/SB|Поместить значение регистра S на шину SB|
|S/ADL|Поместить значение регистра S на шину ADL|
|SB/S|Поместить значение шины SB на регистр S|
|S/S|Рефрешить значение регистра S. Управляющая команда S/S получается комплементом сигнала SB/S (активна, когда неактивна команда SB/S)|

## Логическая схема

![regs_control_logisim](/BreakingNESWiki/imgstore/logisim/regs_control_logisim.jpg)

## Оптимизированная логическая схема

![26_regs_control_logisim](/BreakingNESWiki/imgstore/6502/ttlworks/26_regs_control_logisim.png)
