# Логика установки флагов

![6502_locator_flags_control](/BreakingNESWiki/imgstore/6502_locator_flags_control.jpg)

Схемы управления флагами для удобства разделены на две части:
- Промежуточные контрольные сигналы с декодера (выбор опкодов)
- Контрольные сигналы управления флагами

## Выбор опкодов

|![flags_control_tran1](/BreakingNESWiki/imgstore/flags_control_tran1.jpg)|![flags_control_tran2](/BreakingNESWiki/imgstore/flags_control_tran2.jpg)|![flags_control_tran3](/BreakingNESWiki/imgstore/flags_control_tran3.jpg)|
|---|---|---|

Используемые выходы декодера: 98-99, 107-110, 112-119, 120, 127 (включительно).

|Сигнал|Связанные инструкции декодера|
|---|---|
|!POUT|Работа с флагами наружу (сохранение контекста после прерывания, инструкция `PHP`)|
|/CSI|Инструкции `CLI`, `SEI`|
|BIT1|Инструкция `BIT`, цикл T1|
|X110|110-й выход декодера (инструкции `CLC`, `SEC`), для удобства оставленный в этих схемах. Он просто идёт дальше на основную схему управления флагами.|
|AVR/V|Инструкции `ADC`, `SBC`|
|/ARIT|Матрица инструкций сравнения (`CMP`, `CPX`, `CPY`) и сдвига (`ASL`, `ROL`), где используются флаги|
|BIT0|Инструкция `BIT`, цикл T0|
|!PIN|Работа с флагами внутрь (загрузка контекста после `RTI`, инструкция `PLP`|
|/CSD|Инструкции `CLD`, `SED`|
|CLV|Инструкция CLV|

Все эти контрольные сигналы являются промежуточными и нигде кроме схемы управления флагами больше не используются.

## Управление флагами

