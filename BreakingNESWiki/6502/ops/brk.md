# BRK Последовательность

BRK-последовательность - это унифицированный механизм реакции процессора на внешние сигналы прерываний (`/NMI`, `/IRQ`, `/RES`), а также на выполнение инструкции `BRK` (0x00).

В основной части уже были упоминания о том, как разработчики подошли к унификации этого механизма (инжектирование кода операции 0x00 в регистр инструкций и проч.), в данном разделе производится более подробный анализ.

Дальнейшее рассмотрение состояния производится при учете, что вход `RDY` = 1 (процессор готов).

## Программная модель BRK

Информация общего плана для программистов, достаточная для общего понимания процесса BRK-последовательности.

TBD.

## Сброс

### T0 (PHI1)

Верхняя часть:

Нижняя часть:

В результате того, что выходные командые защелки загружаются только во время PHI2 - их выходные значения сразу после сброса не определены.

Это приводит к тому, что практически все команды нижней части активны (отсутствие заряда на затворах выходных защелок приводит к тому, что на выходе у них 1). В этом случае нижняя часть "сходит с ума".

|Состояние|Примечание|
|---|---|
|ADH/ABH, ADL/ABL|Шина адреса принимает значение 0x0000|
|0/ADL0|1|
|0/ADL1|1|
|0/ADL2|0|
|0/ADH0, 0/ADH17|Обе активных команды приводят к тому, что на шине ADH значение 0x00.|
|Y/SB, SB/Y, X/SB, SB/X, S/ADL, S/SB, SB/S, S/S|Y/SB, X/SB, SB/S, S/S не приводят к эффекту, т.к. регистр обновляется только во время PHI2. В результате текущее значение регистров X, Y, S одновременно помещается на шину SB (для регистра S - также на шину ADL командой S/ADL). Особенность регистра S такая, что значение с выходной защелки выдается в инвертированном виде. То есть на шину SB и ADL помещается значение 0xFF (S = 0). Но так как до этого регистры X/Y уже поместили на шину значение 0x00 - побеждает земля и шина SB принимает значение 0x00|
|NDB/ADD, DB/ADD, 0/ADD, SB/ADD, ADL/ADD, ADD/SB06, ADD/SB7, ADD/ADL, SB/AC, AC/SB, AC/DB, SB/DB, SB/ADH|AI: Команды 0/ADD, SB/ADD приводят к эффекту загрузки 0 на защелку AI и одноврменному "заземлению" шины SB (SB/ADD открывает шину SB, а 0/ADD зануляет её). Но в этом нет смысла, т.к. SB уже заземлена регистровыми операциям. BI: Рассматривать нет смысла (?). Выход ALU: Рассматривать нет смысла (?)|
|Операции АЛУ|Все отключены|
|/ACIN|TBD|
|/DAA|TBD|
|/DSA|TBD|
|#1/PC|TBD|
|ADH/PCH, PCH/PCH, PCH/ADH, PCH/DB, ADL/PCL, PCL/PCL, PCL/ADL, PCL/DB|TBD|
|DL/ADL, DL/ADH, DL/DB|Одновременная установка команд DL/ADL и DL/ADH приводит к замыканию шин ADL/ADH, в результате чего они обе становятся равными 0x00 (ADH уже заземлена командами 0/ADH0, 0/ADH17). DL/DB приводит также к занулению шины DB. Защелка DOR = 0x00.|
|Внутренние шины||
|SB|0x00|
|DB|0x00|
|ADL|0x00|
|ADH|0x00|

### T0 (PHI2)

TBD.

## NMI

TBD.

## IRQ

TBD.

## Смешанное прерывание

Ситуация когда сразу несколько входных контактов прерываний фиксируют событие.

TBD.

## Инструкция BRK

TBD.

## Сброс RDY

Что происходит, если во время BRK-последовательности вход `RDY` становится равным 0 (процессор НЕ готов).

TBD.
