# Расширенный счетчик циклов

![6502_locator_extended_counter](/BreakingNESWiki/imgstore/6502_locator_extended_counter.jpg)

У 6502 есть 3 счетчика циклов:
- Базовый счетчик, используется для коротких инструкций (Считает циклы T0-T1)
- Расширенный (о котором тут пойдёт речь) используется для длинных инструкций (Считает циклы T2-T5)
- Счетчик для очень длинных инструкций (Считает циклы T5-T6)

Под одним циклом (T) понимается два последовательных полу-такта (PHI1 + PHI2) работы процессора.

## Транзисторная схема

![extended_cycle_counter_trans](/BreakingNESWiki/imgstore/extended_cycle_counter_trans.jpg)

Вся схема представляет собой сдвиговый регистр, на вход которого подается контрольный сигнал `T1`. Во время работы сдвигового регистра значение T1 сдвигается и выходит на выход `/T2`, потом на `/T3` и так далее. Выходы /T2-/T5 в инверсной логике.

Сдвиговый регистр используется в роли счетчика для удобства передачи текущего цикла (/T2-/T5) на вход декодера.

Сброс регистра осуществляется командой `TRES2`, происходит это после завершения обработки инструкции.

В состав схемы входят мультиплексоры по сигналу `/ready`. Сделано это для того, чтобы когда процессор не готов (ready=0) - регистр сдвига оставался в текущем состоянии.

## Логическая схема

![extended_cycle_counter_logic](/BreakingNESWiki/imgstore/extended_cycle_counter_logic.jpg)
